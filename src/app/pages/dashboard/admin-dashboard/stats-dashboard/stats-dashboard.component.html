<div class="stats-dashboard">
  <div class="header">
    <h1>📊 Tableau de Bord - Statistiques des Likes</h1>
    <div class="controls">
      <select [value]="selectedPeriod" (change)="onPeriodChange($event)" class="period-select">
        <option value="daily">Quotidien</option>
        <option value="weekly">Hebdomadaire</option>
        <option value="monthly">Mensuel</option>
      </select>
      <select [value]="selectedLimit" (change)="onLimitChange($event)" class="limit-select">
        <option value="7">7 jours</option>
        <option value="30">30 jours</option>
        <option value="90">90 jours</option>
      </select>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Chargement des statistiques...</p>
  </div>

  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="!loading && !error && globalStats && globalStats.globalTotals" class="stats-content">
    <!-- Statistiques globales -->
    <div class="stats-section">
      <h2>📈 Statistiques Globales</h2>
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-icon">👍</div>
          <div class="stat-info">
            <h3>Total des Likes</h3>
            <p class="stat-number">{{ formatNumber(globalStats.globalTotals.totalLikes || 0) }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Articles les plus likés -->
    <div class="stats-section">
      <h2>🏆 Articles les Plus Likés</h2>
      <div class="top-articles">
        <div *ngFor="let item of globalStats.topLikedArticles || []; let i = index" class="article-card">
          <div class="rank">{{ i + 1 }}</div>
          <div class="article-info">
            <h4>{{ item.article?.title || 'Titre non disponible' }}</h4>
            <p class="author">Par: {{ item.article?.authorDetails?.username || 'Auteur inconnu' }}</p>
            <p class="date">{{ formatDate(item.article?.createdAt) }}</p>
          </div>
          <div class="likes-count">
            <span class="likes-number">{{ formatNumber(item.stats && item.stats.totalLikes ? item.stats.totalLikes : 0) }}</span>
            <span class="likes-label">likes</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistiques par période -->
    <div class="stats-section">
      <h2>📅 Évolution des Likes ({{ selectedPeriod }})</h2>
      <div class="period-stats">
        <div *ngFor="let stat of globalStats.periodStats || []" class="period-stat">
          <div class="period-date">
            <span *ngIf="stat.date">{{ formatDate(stat.date) }}</span>
            <span *ngIf="!stat.date">{{ stat.date || 'Date non disponible' }}</span>
          </div>
          <div class="period-likes">
            <span class="likes-number">{{ formatNumber(stat.likes || 0) }}</span>
            <span class="likes-label">likes</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Graphiques Chart.js -->
    <div class="charts-section">
      <h2>📊 Visualisations Graphiques</h2>
      
      <!-- Graphique linéaire - Évolution temporelle -->
      <div class="chart-container">
        <h3>📈 Évolution des Likes dans le Temps</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="lineChartData"
            [options]="lineChartOptions"
            [type]="lineChartType">
          </canvas>
        </div>
      </div>

      <!-- Graphique en barres - Articles les plus likés -->
      <div class="chart-container">
        <h3>🏆 Articles les Plus Likés (Graphique)</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="barChartData"
            [options]="barChartOptions"
            [type]="barChartType">
          </canvas>
        </div>
      </div>
    </div>
  </div>
</div>